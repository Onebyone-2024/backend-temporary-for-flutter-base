# ğŸ¨ Direct Chat Messages - Visual API Diagram

## ğŸ“Š System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND APPLICATION                        â”‚
â”‚                      (Flutter, React, Web, etc)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                    â”‚
                 â–¼                                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  User A (Client) â”‚              â”‚  User B (Client) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                  â”‚
                 â”‚    HTTP/REST API                â”‚
                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                 â”‚                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                    â”‚
        â”‚         NESTJS BACKEND SERVER (Port 3000)         â”‚
        â”‚                                                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  API Gateway / Routing                     â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜  â”‚
        â”‚           â”‚                                 â”‚      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚
        â”‚  â”‚ Auth Controller   â”‚         â”‚ Direct Chats   â”‚ â”‚
        â”‚  â”‚                   â”‚         â”‚ Controller     â”‚ â”‚
        â”‚  â”‚ POST /auth/login  â”‚         â”‚                â”‚ â”‚
        â”‚  â”‚ POST /auth/register        â”‚ POST   /msgs   â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ GET    /msgs   â”‚ â”‚
        â”‚                                â”‚ PATCH  /msgs   â”‚ â”‚
        â”‚                                â”‚ DELETE /msgs   â”‚ â”‚
        â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                         â”‚           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚         Direct Chats Service                  â”‚ â”‚
        â”‚  â”‚                                               â”‚ â”‚
        â”‚  â”‚ â€¢ sendMessage(dto)                            â”‚ â”‚
        â”‚  â”‚ â€¢ getMessages(chatUuid, limit, offset)        â”‚ â”‚
        â”‚  â”‚ â€¢ updateMessage(uuid, message)                â”‚ â”‚
        â”‚  â”‚ â€¢ deleteMessage(uuid)                         â”‚ â”‚
        â”‚  â”‚ â€¢ create(uuid1, uuid2)                        â”‚ â”‚
        â”‚  â”‚ â€¢ findAll()                                   â”‚ â”‚
        â”‚  â”‚ â€¢ findOne(uuid)                               â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                     â”‚                                â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚       Prisma ORM (Data Access)                â”‚ â”‚
        â”‚  â”‚                                               â”‚ â”‚
        â”‚  â”‚ client.directChatMessage.create()             â”‚ â”‚
        â”‚  â”‚ client.directChatMessage.findMany()           â”‚ â”‚
        â”‚  â”‚ client.directChatMessage.update()             â”‚ â”‚
        â”‚  â”‚ client.directChatMessage.delete()             â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                     â”‚                                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    PostgreSQL Database (Supabase)          â”‚
        â”‚                                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚      direct_chat_messages          â”‚   â”‚
        â”‚  â”‚  â”œâ”€ uuid (PK)                      â”‚   â”‚
        â”‚  â”‚  â”œâ”€ direct_chat_uuid (FK)          â”‚   â”‚
        â”‚  â”‚  â”œâ”€ sender_uuid (FK)               â”‚   â”‚
        â”‚  â”‚  â”œâ”€ message (TEXT)                 â”‚   â”‚
        â”‚  â”‚  â”œâ”€ created_at (TIMESTAMP)         â”‚   â”‚
        â”‚  â”‚  â””â”€ updated_at (TIMESTAMP)         â”‚   â”‚
        â”‚  â”‚                                    â”‚   â”‚
        â”‚  â”‚  Indexes:                          â”‚   â”‚
        â”‚  â”‚  â€¢ idx_direct_chat_uuid            â”‚   â”‚
        â”‚  â”‚  â€¢ idx_sender_uuid                 â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Message Flow Diagram

```
User A                                              User B
  â”‚                                                   â”‚
  â”‚  1. LOGIN                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”‚  POST /auth/login                               â”‚
  â”‚  { email, password }                            â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Response: { token, userId }                    â”‚
  â”‚  Save: token, userId=UUID_A                     â”‚
  â”‚                                                   â”‚
  â”‚  2. CREATE DIRECT CHAT                          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”‚  POST /direct-chats                             â”‚
  â”‚  { uuid1: UUID_A, uuid2: UUID_B }              â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Response: { uuid: CHAT_UUID, ... }             â”‚
  â”‚  Save: CHAT_UUID                                â”‚
  â”‚                                                   â”‚
  â”‚  3. SEND MESSAGE                                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”‚  POST /direct-chats/CHAT_UUID/messages          â”‚
  â”‚  { senderUuid: UUID_A, message: "Hi!" }        â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Response: { uuid: MSG_UUID_1, ... }            â”‚
  â”‚                                                   â”‚
  â”‚                                   LOGIN          â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                   { token, UUID_B }
  â”‚                                                   â”‚
  â”‚                            CREATE CHAT (auto)    â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  (Shares same CHAT_UUID)                        â”‚
  â”‚                                                   â”‚
  â”‚  4. LOAD MESSAGE HISTORY                        â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                   â”‚
  â”‚                GET /direct-chats/CHAT_UUID/msgs â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Response: { messages: [...], pagination }      â”‚
  â”‚  Sees: "Hi!" from User A                        â”‚
  â”‚                                                   â”‚
  â”‚  5. SEND REPLY                                  â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  POST /direct-chats/CHAT_UUID/messages          â”‚
  â”‚  { senderUuid: UUID_B, message: "Hello!" }     â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                                                   â”‚
  â”‚  6. GET UPDATED MESSAGES                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”‚  GET /direct-chats/CHAT_UUID/messages           â”‚
  â”‚  Response: [                                     â”‚
  â”‚    { message: "Hi!", sender: User A },          â”‚
  â”‚    { message: "Hello!", sender: User B }        â”‚
  â”‚  ]                                               â”‚
  â”‚                                                   â”‚
  â”‚  7. UPDATE MESSAGE                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”‚  PATCH /direct-chats/messages/MSG_UUID_1        â”‚
  â”‚  { message: "Hi! How are you?" }                â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Response: { message: "Hi! How are you?" }      â”‚
  â”‚                                                   â”‚
  â”‚  8. DELETE MESSAGE (optional)                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”‚  DELETE /direct-chats/messages/MSG_UUID_2       â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Response: 204 No Content                       â”‚
  â”‚                                                   â”‚
```

---

## ğŸ—ï¸ Database Schema Diagram

```
                        USERS TABLE
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      User       â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ uuid (PK)       â”‚
                    â”‚ fullName        â”‚
                    â”‚ email           â”‚
                    â”‚ password        â”‚
                    â”‚ createdAt       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚          â”‚          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚ uuid1 (FK) â”‚    â”‚    â”‚ uuid2 (FK)  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚          â”‚          â”‚
              â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
              â”‚   DIRECT_CHATS TABLE         â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ uuid (PK)                    â”‚
              â”‚ uuid1 (FK â†’ User)            â”‚
              â”‚ uuid2 (FK â†’ User)            â”‚
              â”‚ createdAt                    â”‚
              â”‚                              â”‚
              â”‚ Constraint: uuid1 â‰  uuid2   â”‚
              â”‚ Unique: [uuid1, uuid2]      â”‚
              â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  DIRECT_CHAT_MESSAGES TABLE       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ uuid (PK)                         â”‚
    â”‚ direct_chat_uuid (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ Cascade Delete
    â”‚ sender_uuid (FK) â”€â”               â”‚
    â”‚ message (TEXT)    â”‚               â”‚
    â”‚ created_at        â”‚ Cascade       â”‚
    â”‚ updated_at        â”‚ Delete        â”‚
    â”‚                   â”‚               â”‚
    â”‚ Indexes:          â”‚               â”‚
    â”‚ â€¢ direct_chat_uuidâ”‚               â”‚
    â”‚ â€¢ sender_uuid     â””â”€â†’ USERS TABLE â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API Request/Response Cycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CLIENT REQUEST                           â”‚
â”‚                                                             â”‚
â”‚  POST /direct-chats/{chatUuid}/messages                   â”‚
â”‚  Authorization: Bearer eyJhbGc...                          â”‚
â”‚  Content-Type: application/json                           â”‚
â”‚                                                             â”‚
â”‚  {                                                         â”‚
â”‚    "senderUuid": "550e8400-e29b-41d4-a716-446655440000",  â”‚
â”‚    "message": "Hello!"                                     â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NESTJS CONTROLLER LAYER                       â”‚
â”‚                                                             â”‚
â”‚  @Post(':directChatUuid/messages')                         â”‚
â”‚  sendMessage(                                              â”‚
â”‚    directChatUuid: string,                                â”‚
â”‚    sendDirectChatMessageDto: SendDirectChatMessageDto     â”‚
â”‚  )                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VALIDATION LAYER (DTO)                        â”‚
â”‚                                                             â”‚
â”‚  SendDirectChatMessageDto {                               â”‚
â”‚    @IsUUID() senderUuid: string                           â”‚
â”‚    @IsNotEmpty()                                           â”‚
â”‚    @MinLength(1)                                           â”‚
â”‚    message: string                                         â”‚
â”‚  }                                                         â”‚
â”‚                                                             â”‚
â”‚  âœ“ Validates UUID format                                  â”‚
â”‚  âœ“ Validates message not empty                            â”‚
â”‚  âœ“ Throws 400 Bad Request if invalid                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SERVICE LAYER (Business Logic)               â”‚
â”‚                                                             â”‚
â”‚  async sendMessage(dto: SendDirectChatMessageDto) {        â”‚
â”‚    â€¢ Verify chat exists                                    â”‚
â”‚    â€¢ Verify sender in chat (uuid1 or uuid2)              â”‚
â”‚    â€¢ Verify sender user exists                            â”‚
â”‚    â€¢ Create message in database                           â”‚
â”‚    â€¢ Return with sender details                           â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PERSISTENCE LAYER (Prisma ORM)                  â”‚
â”‚                                                             â”‚
â”‚  client.directChatMessage.create({                        â”‚
â”‚    data: {                                                 â”‚
â”‚      directChatUuid,                                       â”‚
â”‚      senderUuid,                                           â”‚
â”‚      message                                               â”‚
â”‚    },                                                      â”‚
â”‚    include: {                                              â”‚
â”‚      sender: { select: { uuid, fullName, email } },       â”‚
â”‚      directChat: { ... }                                   â”‚
â”‚    }                                                       â”‚
â”‚  })                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE LAYER (PostgreSQL)                  â”‚
â”‚                                                             â”‚
â”‚  INSERT INTO direct_chat_messages (                        â”‚
â”‚    uuid,                                                   â”‚
â”‚    direct_chat_uuid,                                       â”‚
â”‚    sender_uuid,                                            â”‚
â”‚    message,                                                â”‚
â”‚    created_at,                                             â”‚
â”‚    updated_at                                              â”‚
â”‚  ) VALUES (...)                                            â”‚
â”‚                                                             â”‚
â”‚  SELECT * FROM direct_chat_messages ...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SERVER RESPONSE                          â”‚
â”‚                                                             â”‚
â”‚  HTTP/1.1 201 Created                                      â”‚
â”‚  Content-Type: application/json                           â”‚
â”‚                                                             â”‚
â”‚  {                                                         â”‚
â”‚    "uuid": "msg-uuid-1234",                               â”‚
â”‚    "directChatUuid": "chat-uuid-5678",                    â”‚
â”‚    "senderUuid": "550e8400-e29b-41d4-a716-446655440000", â”‚
â”‚    "message": "Hello!",                                    â”‚
â”‚    "createdAt": "2025-12-03T12:00:00Z",                  â”‚
â”‚    "updatedAt": "2025-12-03T12:00:00Z",                  â”‚
â”‚    "sender": {                                             â”‚
â”‚      "uuid": "550e8400-e29b-41d4-a716-446655440000",     â”‚
â”‚      "fullName": "John Doe",                              â”‚
â”‚      "email": "john@example.com"                          â”‚
â”‚    },                                                      â”‚
â”‚    "directChat": { ... }                                   â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CLIENT RECEIVES RESPONSE                 â”‚
â”‚                  âœ… Message sent successfully!             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication & Authorization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Login  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
POST /auth/login
  { email, password }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Token Generated             â”‚
â”‚  eyJhbGciOiJIUzI1NiIsInR5cCI... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Save in Headers
             â”‚
             â–¼
GET /direct-chats/:uuid/messages
  Authorization: Bearer JWT_TOKEN
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Guard Validates Token             â”‚
â”‚  â€¢ Decode token                        â”‚
â”‚  â€¢ Verify signature                    â”‚
â”‚  â€¢ Check expiration                    â”‚
â”‚  â€¢ Extract user info                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
   âœ… Valid          âŒ Invalid
    â”‚                 â”‚
    â–¼                 â–¼
Request            Return 401
Authorized         Unauthorized
    â”‚
    â–¼
Execute Endpoint Logic
    â”‚
    â–¼
Return Response âœ…
```

---

## ğŸ“ˆ Pagination Flow

```
Client Request:
GET /direct-chats/{chatUuid}/messages?limit=20&offset=40

                   â–¼

Prisma Query:
.findMany({
  where: { directChatUuid: '...' },
  take: 20      â† Limit
  skip: 40      â† Offset
  orderBy: { createdAt: 'asc' }
})

                   â–¼

Database Query:
SELECT * FROM direct_chat_messages
WHERE direct_chat_uuid = '...'
ORDER BY created_at ASC
LIMIT 20
OFFSET 40

                   â–¼

Calculate Pagination Info:
total = 100 (total messages in chat)
limit = 20
offset = 40
hasMore = (40 + 20 < 100) = true

                   â–¼

Response:
{
  messages: [ {...}, {...}, ... ], (20 messages)
  pagination: {
    total: 100,
    limit: 20,
    offset: 40,
    hasMore: true     â† More messages available
  }
}

                   â–¼

Client Loads Next:
GET /messages?limit=20&offset=60
(offset = 40 + 20)
```

---

## âœ… Complete Feature Overview

```
DIRECT CHAT MESSAGES API v1.0.0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ENDPOINTS:            âœ… 4 ENDPOINTS
â”œâ”€ POST   messages    (Send)
â”œâ”€ GET    messages    (Get with pagination)
â”œâ”€ PATCH  messages    (Update)
â””â”€ DELETE messages    (Delete)

FEATURES:             âœ… 8 FEATURES
â”œâ”€ Message Creation
â”œâ”€ Message History
â”œâ”€ Pagination
â”œâ”€ Edit Messages
â”œâ”€ Delete Messages
â”œâ”€ Sender Validation
â”œâ”€ Timestamps
â””â”€ Error Handling

VALIDATION:           âœ… 5 VALIDATIONS
â”œâ”€ UUID Format
â”œâ”€ Sender Membership
â”œâ”€ Message Not Empty
â”œâ”€ Chat Existence
â””â”€ User Existence

SECURITY:             âœ… 4 SECURITY LAYERS
â”œâ”€ JWT Authentication
â”œâ”€ Input Validation
â”œâ”€ Database Constraints
â””â”€ Sender Verification

PERFORMANCE:          âœ… 3 OPTIMIZATIONS
â”œâ”€ Indexed Queries
â”œâ”€ Pagination
â””â”€ Efficient ORM

BUILD STATUS:         âœ… ALL PASSING
â”œâ”€ TypeScript
â”œâ”€ Prisma
â”œâ”€ Routes
â””â”€ No Errors
```

---

**Visual Diagrams Created:** December 3, 2025  
**Status:** âœ… Complete
